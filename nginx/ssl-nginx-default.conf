server {
   listen 443;
   server_name local.foncia-locations-vacances.fr;
   root /var/www/html;
   index index.php;

    ssl     on;

    ssl_certificate /etc/nginx/foncia.crt;
    ssl_certificate_key /etc/nginx/foncia.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
    ssl_ecdh_curve secp384r1; # Requires nginx >= 1.1.0
    ssl_session_cache shared:SSL:10m;
    ssl_session_tickets off; # Requires nginx >= 1.5.9

   if (!-f $request_filename) {
       rewrite ^(.*)$ /404;
   }
   location ~ "^/[^/]*\.php$" {
      set $script "index.php";
      if ( $uri ~ "^/(.*\.php)" ) {
         set $script $1;
      }
      fastcgi_pass php-upstream;
      fastcgi_index  index.php;
      fastcgi_read_timeout 1000;
      fastcgi_param  SCRIPT_FILENAME /var/www/html/$script;
      include        fastcgi_params;
   }
   location / {
           rewrite "^/var/storage/(.*)$" "/var/storage/$1" break;
           rewrite "^/var/([^/]+)/storage/(.*)$" "/var/$1/storage/$2" break;
           rewrite "^/var/(([^/]+/)?)cache/(texttoimage|public)/(.*)$" "/var/$1cache/$3/$4" break;
           rewrite "^/design/([^/]+)/(stylesheets|images|javascript)/(.*)$" "/design/$1/$2/$3" break;
           rewrite "^/share/icons/(.*)$" "/share/icons/$1" break;
           rewrite "^/extension/([^/]+)/design/([^/]+)/(stylesheets|images|javascripts|javascript|flash|lib?)/(.*)$" "/extension/$1/design/$2/$3/$4" break;
           rewrite "^/packages/styles/(.+)/(stylesheets|images|javascript)/([^/]+)/(.*)$" "/packages/styles/$1/$2/$3/$4" break;
           rewrite "^/packages/styles/(.+)/thumbnail/(.*)$" "/packages/styles/$1/thumbnail/$2" break;
           rewrite "^/favicon\.ico$" "/favicon.ico" break;
           rewrite "^/robots\.txt$" "/robots.txt" break;
           rewrite "^/var/cache/debug.html(.*)$" "/var/cache/debug.html$1" break;
           rewrite "^/var/(([^/]+/)?)cache/public/(.*)$" "/var/$1cache/public/$3" break;
           rewrite "^/var/([^/]+)/cache/debug\.html(.*)$" "/var/$1/cache/debug.html$2" break;
           rewrite "content/treemenu/?$" "/index_treemenu.php" break;
           rewrite "ezjscore/call/?$" "/index_ajax.php" break;
           rewrite "^(.*)$" "/index.php?$1" last;
   }
}
